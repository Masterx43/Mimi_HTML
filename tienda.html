<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mimi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./assets/css/style.css">
</head>

<body>
    <div class="container cajita-fondo">
        <!-- NAVBAR -->
        <div class="row mt-1">
            <nav class="navbar navbar-light bg-light w-100 px-3">
                <a class="navbar-brand" href="index.html">
                    <img src="./assets/img/mimi.logo.webp" alt="logoMimi" height="60">
                </a>
                <!-- Contador carrito -->
                <button class="btn position-relative ms-auto" type="button" id="btnCart">
                    <i class="fa-solid fa-cart-shopping"></i>
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                        id="cartCount">0</span>
                </button>
            </nav>
        </div>
        <!-- /NAVBAR -->

        <!-- TIENDA -->
        <section class="mt-4">
            <h2 class="text-center mb-3">Tienda</h2>
            <div class="row g-4">
                <!-- Producto 1 -->
                <div class="col-12 col-md-6 col-xl-4">
                    <div class="card h-100">
                        <img src="./assets/img/Manicure.webp" class="card-img-top fit" alt="Manicure">
                        <div class="card-body text-center">
                            <h5 class="card-title">Pack Manicure</h5>
                            <p class="fw-bold mb-2">$12.990</p>
                            <button class="btn botonRosado btn-add-to-cart" data-id="SKU-001" data-name="Pack Manicure"
                                data-price="12990" data-img="./assets/img/Manicure.webp">Agregar al carrito</button>
                        </div>
                    </div>
                </div>
                <!-- Producto 2 -->
                <div class="col-12 col-md-6 col-xl-4">
                    <div class="card h-100">
                        <img src="./assets/img/tratamientos-capilares.jpg" class="card-img-top fit" alt="Tratamiento">
                        <div class="card-body text-center">
                            <h5 class="card-title">Tratamiento Capilar</h5>
                            <p class="fw-bold mb-2">$18.990</p>
                            <button class="btn botonRosado btn-add-to-cart" data-id="SKU-002"
                                data-name="Tratamiento Capilar" data-price="18990"
                                data-img="./assets/img/tratamientos-capilares.jpg">Agregar al carrito</button>
                        </div>
                    </div>
                </div>
                <!-- Producto 3 -->
                <div class="col-12 col-md-6 col-xl-4">
                    <div class="card h-100">
                        <img src="./assets/img/brushing-y-styling.webp" class="card-img-top fit" alt="Brushing">
                        <div class="card-body text-center">
                            <h5 class="card-title">Brushing & Styling</h5>
                            <p class="fw-bold mb-2">$15.990</p>
                            <button class="btn botonRosado btn-add-to-cart" data-id="SKU-003"
                                data-name="Brushing & Styling" data-price="15990"
                                data-img="./assets/img/brushing-y-styling.webp">Agregar al carrito</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- /TIENDA -->

        <!-- CARRITO SIMPLE (sección fija en la página) -->
        <section class="mt-5">
            <h3>🛒 Carrito</h3>
            <ul class="list-group mb-3" id="cartItems">
                <li class="list-group-item text-center text-muted">Tu carrito está vacío</li>
            </ul>
            <div class="d-flex justify-content-between align-items-center mb-3">
                <strong>Total:</strong>
                <strong id="cartTotal">$0</strong>
            </div>
            <div class="d-flex gap-2">
                <button class="btn btn-outline-secondary" id="btnEmptyCart">Vaciar</button>
                <button class="btn botonRosado" id="btnCheckout">Pagar</button>
            </div>
        </section>
    </div><!-- /container -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/bf539c3725.js" crossorigin="anonymous"></script>

    <script>
        (() => {
            const CURRENCY = new Intl.NumberFormat('es-CL', { style: 'currency', currency: 'CLP', maximumFractionDigits: 0 });
            let cart = [];

            const els = {
                cartCount: document.getElementById('cartCount'),
                cartItems: document.getElementById('cartItems'),
                cartTotal: document.getElementById('cartTotal'),
                btnEmpty: document.getElementById('btnEmptyCart'),
                btnCheckout: document.getElementById('btnCheckout')
            };

            function renderCart() {
                els.cartItems.innerHTML = '';
                if (cart.length === 0) {
                    els.cartItems.innerHTML = '<li class="list-group-item text-center text-muted">Tu carrito está vacío</li>';
                } else {
                    cart.forEach(item => {
                        const li = document.createElement('li');
                        li.className = 'list-group-item d-flex justify-content-between align-items-center';
                        li.innerHTML = `
            ${item.name} x${item.qty}
            <span>${CURRENCY.format(item.price * item.qty)}</span>`;
                        els.cartItems.appendChild(li);
                    });
                }
                const total = cart.reduce((acc, it) => acc + it.price * it.qty, 0);
                els.cartTotal.textContent = CURRENCY.format(total);
                els.cartCount.textContent = cart.reduce((a, b) => a + b.qty, 0);
            }

            function addToCart(product) {
                const found = cart.find(p => p.id === product.id);
                if (found) {
                    found.qty++;
                } else {
                    cart.push({ ...product, qty: 1 });
                }
                renderCart();
            }

            document.addEventListener('click', (e) => {
                const btn = e.target.closest('.btn-add-to-cart');
                if (btn) {
                    addToCart({
                        id: btn.dataset.id,
                        name: btn.dataset.name,
                        price: Number(btn.dataset.price),
                        img: btn.dataset.img
                    });
                }
            });

            els.btnEmpty.addEventListener('click', () => { cart = []; renderCart(); });
            els.btnCheckout.addEventListener('click', () => {
                if (cart.length === 0) return alert('Carrito vacío');
                alert('Aquí iría el pago (simulado)');
            });

            renderCart();
        })();
    </script>
</body>

</html>